<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./css/style.css" />

    <title>random park spin</title>
  </head>
  <body class="killar">
    <div class="container py-5 my-md-5">
      <div class="row align-items-center text-center">
        <div class="col-12">
          <h3 class="mb-4">mobile用<br />ランダムパークチャレンジ</h3>
        </div>
        <div class="col-12">
          <a href="./" class="btn tab-button">サバイバー</a>
          <a href="./killar.html" class="btn check-all-button">キラー</a>
          <hr />
        </div>
        <div class="col-12">
          <div class="row align-items-center text-center">
            <div class="col-6 col-md-3 py-md-5" id="reel1">
              <img class="symbol-img" src="./img/dbd.png" alt="symbol" />
              <p class="symbol-text mt-2 mb-0 text-center">---</p>
              <p class="user mt-1 text-center">---</p>
            </div>
            <div class="col-6 col-md-3 py-md-5" id="reel2">
              <img class="symbol-img" src="./img/dbd.png" alt="symbol" />
              <p class="symbol-text mt-2 mb-0">---</p>
              <p class="user mt-1 text-center">---</p>
            </div>
            <div class="col-6 col-md-3 py-md-5" id="reel3">
              <img class="symbol-img" src="./img/dbd.png" alt="symbol" />
              <p class="symbol-text mt-2 mb-0 text-center">---</p>
              <p class="user mt-1 text-center">---</p>
            </div>
            <div class="col-6 col-md-3 py-md-5" id="reel4">
              <img class="symbol-img" src="./img/dbd.png" alt="symbol" />
              <p class="symbol-text mt-2 mb-0 text-center">---</p>
              <p class="user mt-1 text-center">---</p>
            </div>
          </div>
        </div>

        <div class="col-12 mb-3">
          <button id="spin-button">スタート＆ストップ</button>
        </div>
      </div>
      <hr />
      <div class="row align-items-center text-start">
        <div class="col-12">
          <p id="symbol-text-display" class="mb-4"></p>
        </div>
      </div>
      <hr />
      <div class="row align-items-center text-center">
        <div class="col-12 mb-0 mt-5">
          <h5>チェックを外すと該当キャラのパークがルーレットから外れます</h5>
        </div>
        <div class="col-12 my-3 mb-3">
          <button id="check-all-button">全てのパークを含める</button>
          <button id="uncheck-all-button">全てのパークを外す</button>
          <button id="remember-button">選択状態をブラウザに記憶</button>
        </div>
        <div class="col-auto p-2 px-3">
          <div class="form-check">
            <input
              class="form-check-input symbol-group"
              type="checkbox"
              value="common"
              id="common"
            />
            <label class="form-check-label" for="common"> 共通パーク </label>
          </div>
        </div>
        <div class="col-auto p-2 px-3">
          <div class="form-check">
            <input
              class="form-check-input symbol-group"
              type="checkbox"
              value="crown"
              id="crown"
            />
            <label class="form-check-label" for="crown"> クラウン </label>
          </div>
        </div>
        <div class="col-auto p-2 px-3">
          <div class="form-check">
            <input
              class="form-check-input symbol-group"
              type="checkbox"
              value="trickstar"
              id="trickstar"
            />
            <label class="form-check-label" for="trickstar">
              トリックスター
            </label>
          </div>
        </div>
        <div class="col-auto p-2 px-3">
          <div class="form-check">
            <input
              class="form-check-input symbol-group"
              type="checkbox"
              value="senoba"
              id="senoba"
            />
            <label class="form-check-label" for="senoba"> セノバイト </label>
          </div>
        </div>
        <div class="col-auto p-2 px-3">
          <div class="form-check">
            <input
              class="form-check-input symbol-group"
              type="checkbox"
              value="canival"
              id="canival"
            />
            <label class="form-check-label" for="canival"> カニバル </label>
          </div>
        </div>
        <div class="col-auto p-2 px-3">
          <div class="form-check">
            <input
              class="form-check-input symbol-group"
              type="checkbox"
              value="nightmare"
              id="nightmare"
            />
            <label class="form-check-label" for="nightmare"> ナイトメア </label>
          </div>
        </div>
        <div class="col-auto p-2 px-3">
          <div class="form-check">
            <input
              class="form-check-input symbol-group"
              type="checkbox"
              value="resion"
              id="resion"
            />
            <label class="form-check-label" for="resion"> リージョン </label>
          </div>
        </div>
        <div class="col-auto p-2 px-3">
          <div class="form-check">
            <input
              class="form-check-input symbol-group"
              type="checkbox"
              value="artist"
              id="artist"
            />
            <label class="form-check-label" for="artist"> アーティスト </label>
          </div>
        </div>
        <div class="col-auto p-2 px-3">
          <div class="form-check">
            <input
              class="form-check-input symbol-group"
              type="checkbox"
              value="trapper"
              id="trapper"
            />
            <label class="form-check-label" for="trapper"> トラッパー </label>
          </div>
        </div>
        <div class="col-auto p-2 px-3">
          <div class="form-check">
            <input
              class="form-check-input symbol-group"
              type="checkbox"
              value="billy"
              id="billy"
            />
            <label class="form-check-label" for="billy"> ヒルビリー </label>
          </div>
        </div>
        <div class="col-auto p-2 px-3">
          <div class="form-check">
            <input
              class="form-check-input symbol-group"
              type="checkbox"
              value="pig"
              id="pig"
            />
            <label class="form-check-label" for="pig"> ピッグ </label>
          </div>
        </div>
        <div class="col-auto p-2 px-3">
          <div class="form-check">
            <input
              class="form-check-input symbol-group"
              type="checkbox"
              value="hug"
              id="hug"
            />
            <label class="form-check-label" for="hug"> ハグ </label>
          </div>
        </div>
        <div class="col-auto p-2 px-3">
          <div class="form-check">
            <input
              class="form-check-input symbol-group"
              type="checkbox"
              value="nurse"
              id="nurse"
            />
            <label class="form-check-label" for="nurse"> ナース </label>
          </div>
        </div>
        <div class="col-auto p-2 px-3">
          <div class="form-check">
            <input
              class="form-check-input symbol-group"
              type="checkbox"
              value="doctor"
              id="doctor"
            />
            <label class="form-check-label" for="doctor"> ドクター </label>
          </div>
        </div>
        <div class="col-auto p-2 px-3">
          <div class="form-check">
            <input
              class="form-check-input symbol-group"
              type="checkbox"
              value="gost"
              id="gost"
            />
            <label class="form-check-label" for="gost">
              ゴーストフェイス
            </label>
          </div>
        </div>
        <div class="col-auto p-2 px-3">
          <div class="form-check">
            <input
              class="form-check-input symbol-group"
              type="checkbox"
              value="prage"
              id="prage"
            />
            <label class="form-check-label" for="prage"> プレイグ </label>
          </div>
        </div>
        <div class="col-auto p-2 px-3">
          <div class="form-check">
            <input
              class="form-check-input symbol-group"
              type="checkbox"
              value="death"
              id="death"
            />
            <label class="form-check-label" for="death"> デススリンガー </label>
          </div>
        </div>
        <div class="col-auto p-2 px-3">
          <div class="form-check">
            <input
              class="form-check-input symbol-group"
              type="checkbox"
              value="spilit"
              id="spilit"
            />
            <label class="form-check-label" for="spilit"> スピリット </label>
          </div>
        </div>
        <div class="col-auto p-2 px-3">
          <div class="form-check">
            <input
              class="form-check-input symbol-group"
              type="checkbox"
              value="sadako"
              id="sadako"
            />
            <label class="form-check-label" for="sadako"> 貞子 </label>
          </div>
        </div>
        <div class="col-auto p-2 px-3">
          <div class="form-check">
            <input
              class="form-check-input symbol-group"
              type="checkbox"
              value="wraith"
              id="wraith"
            />
            <label class="form-check-label" for="wraith"> レイス </label>
          </div>
        </div>
        <div class="col-auto p-2 px-3">
          <div class="form-check">
            <input
              class="form-check-input symbol-group"
              type="checkbox"
              value="shape"
              id="shape"
            />
            <label class="form-check-label" for="shape"> シェイプ </label>
          </div>
        </div>
        <div class="col-auto p-2 px-3">
          <div class="form-check">
            <input
              class="form-check-input symbol-group"
              type="checkbox"
              value="oni"
              id="oni"
            />
            <label class="form-check-label" for="oni"> 鬼 </label>
          </div>
        </div>
        <div class="col-auto p-2 px-3">
          <div class="form-check">
            <input
              class="form-check-input symbol-group"
              type="checkbox"
              value="twins"
              id="twins"
            />
            <label class="form-check-label" for="twins"> ツインズ </label>
          </div>
        </div>
        <div class="col-auto p-2 px-3">
          <div class="form-check">
            <input
              class="form-check-input symbol-group"
              type="checkbox"
              value="hunt"
              id="hunt"
            />
            <label class="form-check-label" for="hunt"> ハントレス </label>
          </div>
        </div>
        <div class="col-auto p-2 px-3">
          <div class="form-check">
            <input
              class="form-check-input symbol-group"
              type="checkbox"
              value="singura"
              id="singura"
            />
            <label class="form-check-label" for="singura">
              シンギュラリティ
            </label>
          </div>
        </div>
        <div class="col-auto p-2 px-3">
          <div class="form-check">
            <input
              class="form-check-input symbol-group"
              type="checkbox"
              value="chacky"
              id="chacky"
            />
            <label class="form-check-label" for="chacky"> チャッキー </label>
          </div>
        </div>
        <div class="col-auto p-2 px-3">
          <div class="form-check">
            <input
              class="form-check-input symbol-group"
              type="checkbox"
              value="bright"
              id="bright"
            />
            <label class="form-check-label" for="bright"> ブライト </label>
          </div>
        </div>
        <div class="col-auto p-2 px-3">
          <div class="form-check">
            <input
              class="form-check-input symbol-group"
              type="checkbox"
              value="dredge"
              id="dredge"
            />
            <label class="form-check-label" for="dredge"> ドレッジ </label>
          </div>
        </div>
        <div class="col-auto p-2 px-3">
          <div class="form-check">
            <input
              class="form-check-input symbol-group"
              type="checkbox"
              value="night"
              id="night"
            />
            <label class="form-check-label" for="night"> ナイト </label>
          </div>
        </div>
        <div class="col-auto p-2 px-3">
          <div class="form-check">
            <input
              class="form-check-input symbol-group"
              type="checkbox"
              value="marchan"
              id="marchan"
            />
            <label class="form-check-label" for="marchan"> マーチャント </label>
          </div>
        </div>
        <div class="col-auto p-2 px-3">
          <div class="form-check">
            <input
              class="form-check-input symbol-group"
              type="checkbox"
              value="buy"
              id="buy"
            />
            <label class="form-check-label" for="buy"> 購入パーク </label>
          </div>
        </div>
      </div>
    </div>

    <script>
      document
        .getElementById("remember-button")
        .addEventListener("click", () => {
          const checkedGroupsKillar = Array.from(
            document.querySelectorAll(".symbol-group:checked")
          ).map((el) => el.value);

          localStorage.setItem(
            "checkedGroupsKillar",
            JSON.stringify(checkedGroupsKillar)
          );
          alert("チェックしたグループが記憶されました。");
        });

      const reels = [
        document.getElementById("reel1"),
        document.getElementById("reel2"),
        document.getElementById("reel3"),
        document.getElementById("reel4"),
      ];

      const spinReel = (reel, availableSymbols) => {
        return new Promise((resolve) => {
          let count = 0;
          const interval = setInterval(() => {
            const symbol =
              availableSymbols[
                Math.floor(Math.random() * availableSymbols.length)
              ];
            reel.querySelector(".symbol-img").src = symbol.img;
            reel.querySelector(".symbol-text").textContent = symbol.text;
            reel.querySelector(".user").textContent = symbol.user;
            if (count > 20) {
              clearInterval(interval);
              resolve(symbol);
            }
            count++;
          }, 10);
        });
      };

      document
        .getElementById("spin-button")
        .addEventListener("click", async () => {
          document.getElementById("spin-button").disabled = true;

          const checkedGroups = Array.from(
            document.querySelectorAll(".symbol-group:checked")
          ).map((el) => el.value);

          const availableSymbols = symbols.filter((symbol) =>
            checkedGroups.includes(symbol.group)
          );

          let showAlert = false;

          const usedSymbols = [];
          const selectedSymbolsText = [];
          for (const reel of reels) {
            const symbolsForReel = availableSymbols.filter(
              (symbol) =>
                !usedSymbols.some((usedSymbol) => usedSymbol.img === symbol.img)
            );

            if (symbolsForReel.length === 0) {
              if (!showAlert) {
                alert("選択されたグループに対応するシンボルがありません。");
                showAlert = true;
              }
              continue;
            }

            const symbol = await spinReel(reel, symbolsForReel);
            usedSymbols.push(symbol);

            let textWithKana = symbol.text;
            if (symbol.kana) {
              textWithKana += " (" + symbol.kana + ")";
            }

            selectedSymbolsText.push(textWithKana + " <br>");
          }

          const symbolTextElement = document.getElementById(
            "symbol-text-display"
          );
          if (symbolTextElement) {
            symbolTextElement.innerHTML = selectedSymbolsText.join("<br>");
          }

          document.getElementById("spin-button").disabled = false;
        });

      document
        .getElementById("check-all-button")
        .addEventListener("click", () => {
          const checkboxes = document.querySelectorAll(".symbol-group");
          checkboxes.forEach((checkbox) => {
            checkbox.checked = true;
          });
        });

      document
        .getElementById("uncheck-all-button")
        .addEventListener("click", () => {
          const checkboxes = document.querySelectorAll(".symbol-group");
          checkboxes.forEach((checkbox) => {
            checkbox.checked = false;
          });
        });

      window.addEventListener("load", () => {
        const savedGroups = JSON.parse(
          localStorage.getItem("checkedGroupsKillar")
        );
        if (savedGroups) {
          savedGroups.forEach((group) => {
            const checkbox = document.querySelector(
              `.symbol-group[value="${group}"]`
            );
            console.log(checkbox);
            if (checkbox) {
              checkbox.checked = true;
            }
          });
        }
      });
    </script>
    <script src="./js/constants-killar.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
